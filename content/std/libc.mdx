---
title: libc
---

# libc

## 概述
libc 标准库提供了对 C 标准库的底层封装，包括系统调用、时间处理、文件操作等基础功能。

## 类型

### tm_t
时间信息结构体，用于表示分解后的时间信息。

```nature
type tm_t = struct {
    i32 tm_sec     // 秒 [0-60]
    i32 tm_min     // 分 [0-59]
    i32 tm_hour    // 时 [0-23]
    i32 tm_mday    // 日 [1-31]
    i32 tm_mon     // 月 [0-11]
    i32 tm_year    // 年 (从1900年开始)
    i32 tm_wday    // 星期 [0-6] (星期日=0)
    i32 tm_yday    // 一年中的第几天 [0-365]
    i32 tm_isdst   // 夏令时标志
    i64 tm_gmtoff  // GMT偏移量
    void_ptr tm_zone // 时区名称
}
```

### dir_t
目录句柄类型。

```nature
type dir_t = void_ptr
```

### dirent_t
目录项结构体，用于表示目录中的文件信息。

```nature
type dirent_t = struct {
    u64 ino        // inode 编号
    u64 off        // 目录偏移量
    u16 reclen     // 记录长度
    u16 namlen     // 文件名长度
    u8 t           // 文件类型
    arr<u8,1024> name  // 文件名
}
```

## 函数

### 时间相关

#### localtime()
将时间戳转换为本地时间结构体。

```nature
fn localtime(raw_ptr<i64> timestamp):raw_ptr<tm_t>
```

#### mktime()
将时间结构体转换为时间戳。

```nature
fn mktime(raw_ptr<tm_t> time_info):i64
```

#### strftime()
格式化时间字符串。

```nature
fn strftime(void_ptr s, i64 size, void_ptr format, raw_ptr<tm_t> time_info):i64
```

### 目录操作

#### opendir()
打开目录。

```nature
fn opendir(void_ptr str):dir_t
```

#### readdir()
读取目录项。

```nature
fn readdir(dir_t d):raw_ptr<dirent_t>
```

#### closedir()
关闭目录。

```nature
fn closedir(dir_t d):int
```

### 系统相关

#### getcwd()
获取当前工作目录。

```nature
fn getcwd(void_ptr path, uint size):void_ptr
```

#### fork()
创建子进程。

```nature
fn fork():int
```

#### exit()
退出程序。

```nature
fn exit(i32 status)
```

#### sleep()
休眠指定秒数。

```nature
fn sleep(int second)
```

#### usleep()
休眠指定微秒数。

```nature
fn usleep(u32 usec):i32
```

### 字符串操作

#### strlen()
获取字符串长度。

```nature
fn strlen(void_ptr str):uint
```

#### strstr()
查找子字符串。

```nature
fn strstr(void_ptr haystack, void_ptr needle):void_ptr
```

#### strrstr()
从后向前查找子字符串。

```nature
fn strrstr(void_ptr haystack, void_ptr needle):void_ptr
```

### 其他功能

#### get_envs()
获取环境变量列表。

```nature
fn get_envs():[string]
```

#### errno()
获取最近的错误码。

```nature
fn errno():int
```

#### strerror()
获取错误描述字符串。

```nature
fn strerror():string
```

## 使用示例

```nature
import libc

fn main() {
    // 获取当前工作目录
    var path = new arr<u8>(256)
    libc.getcwd(path.ref(), path.len())
    
    // 打开目录
    var dir = libc.opendir(path.ref())
    if dir == null {
        println("Failed to open directory")
        return
    }
    
    // 读取目录内容
    var entry = libc.readdir(dir)
    while entry != null {
        // 处理目录项
        entry = libc.readdir(dir)
    }
    
    // 关闭目录
    libc.closedir(dir)
}
```

## 注意事项
1. 该标准库提供了对系统底层功能的直接访问，使用时需要注意内存安全
2. 部分函数返回的是原始指针（raw_ptr），需要谨慎处理
3. 某些函数的行为可能因操作系统而异
4. 使用系统相关功能时，建议做好错误处理
