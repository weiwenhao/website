---
title: ç±»å‹
sidebar_position: 30
---

åœ¨ nature ä¸­æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œä¸åŒçš„ç±»å‹åœ¨å†…å­˜ä¸­å ç”¨çš„å¤§å°æ˜¯ä¸ç›¸åŒçš„ã€‚ç±»å‹åˆ†ä¸ºç®€å•ç±»å‹ä¸å¤åˆç±»å‹ã€‚

## ç®€å•ç±»å‹

| å…³é”®å­— | å­˜å‚¨å¤§å° byte | è¯´æ˜                                                                       |
| ------ | ------------- | -------------------------------------------------------------------------- |
| int    | -             | æœ‰ç¬¦å·æ•´å‹ï¼Œä¸è¿è¡Œå¹³å°çš„ cpu ä½å®½ä¸€è‡´,æ¯”å¦‚ 64 ä½ä¸‹ int å ç”¨ 8byte = 64bit  |
| i8     | 1             | æœ‰ç¬¦å·æ•´å‹                                                                 |
| i16    | 2             | æœ‰ç¬¦å·æ•´å‹                                                                 |
| i32    | 4             | æœ‰ç¬¦å·æ•´å‹                                                                 |
| i64    | 8             | æœ‰ç¬¦å·æ•´å‹                                                                 |
| uint   | -             | æ— ç¬¦å·æ•´å‹ï¼Œä¸ç›®æ ‡å¹³å° cpu ä½å®½ ä¸€è‡´                                       |
| u8     | 1             | æ— ç¬¦å·æ•´å‹                                                                 |
| u16    | 2             | æ— ç¬¦å·æ•´å‹                                                                 |
| u32    | 4             | æ— ç¬¦å·æ•´å‹                                                                 |
| u64    | 8             | æ— ç¬¦å·æ•´å‹                                                                 |
| float  | -             | æµ®ç‚¹æ•°ï¼Œä¸æ‰§è¡Œå¹³å°çš„ cpu ä½å®½ä¸€è‡´,æ¯”å¦‚ 64 ä½ cpu ä¸‹å ç”¨ 8byte, ä¸ f64 ä¸€è‡´ |
| f32    | 4             | å•ç²¾åº¦æµ®ç‚¹æ•°                                                               |
| f64    | 8             | åŒç²¾åº¦æµ®ç‚¹æ•°                                                               |
| bool   | 1             | å¸ƒå°”ç±»å‹ï¼Œå€¼æœ‰ true å’Œ false                                               |

bool ç±»å‹çš„å€¼æ˜¯**å°å†™**çš„ true å’Œ falseã€‚

:::caution
åœ¨ 64 ä½ç³»ç»Ÿä¸‹ï¼Œc è¯­è¨€çš„ float = f32, è€Œ nature ä¸­ float = f64
:::

ç”±äºç®€å•ç±»å‹åœ¨å †å¤–å­˜å‚¨ï¼Œæ‰€ä»¥å…¶åœ¨å„ç§èµ‹å€¼æ“ä½œï¼Œå‡½æ•°å‚æ•°ä¼ é€’ç­‰æ“ä½œæ—¶éƒ½æ˜¯**å€¼ä¼ é€’**ã€‚

## å¤åˆç±»å‹

å¤æ‚ç±»å‹å¯ä»¥ç†è§£ä¸ºç”±ç®€å•ç±»å‹ç»„åˆå¹¶å†…ç½®åœ¨ nature ä¸­çš„ç»“æ„ï¼Œå…¶ä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰ï¼Œæ¯”å¦‚ string ç±»å‹ï¼Œå…¶å°±æ˜¯ç”±å¤šä¸ª u8 ç±»å‹ç»„æˆã€‚

![](https://raw.githubusercontent.com/weiwenhao/pictures/main/blogs20230627185345.png)

å¤§éƒ¨åˆ†å¤åˆç±»å‹çš„ä¸»ä½“éƒ½å­˜å‚¨åœ¨äº†å †ä¸­ï¼Œå †å¤–å­˜å‚¨çš„æ˜¯æŒ‡é’ˆã€‚å­˜å‚¨åœ¨ heap ä¸­ç±»å‹åœ¨å„ç§èµ‹å€¼æ“ä½œï¼Œå‡½æ•°å‚æ•°ä¼ é€’ç­‰æ“ä½œæ—¶éƒ½æ˜¯**å¼•ç”¨ä¼ é€’**ï¼Œä¹Ÿå°±æ˜¯ä¼ é€’äº†æŒ‡é’ˆï¼Œä¸ä¼šä¿®æ”¹æˆ–å¤åˆ¶å †ä¸Šçš„æ•°æ®

| ç±»å‹åç§° | å­˜å‚¨ä½ç½® | å…³é”®å­—     | ç¤ºä¾‹                                          | è¯´æ˜                                |
| -------- | -------- | ---------- | --------------------------------------------- | ----------------------------------- |
| string   | heap     | string     | `string str = 'hello world'`                  |                                     |
| vec      | heap     | `[T]`      | `[int] list = [1, 2, 3, 4]`                   |                                     |
| map      | heap     | `{T:T}`    | `{int:string} map = {1: 'a', 2: 'b'}`         | key ç±»å‹ä»…æ”¯æŒ integer/float/string |
| set      | heap     | `{T}`      | `{int} set = {1, 2, 3, 4}`                    |                                     |
| tup      | heap     | `(T)`      | `(int, bool) t = (1, true)`                   |                                     |
| fn       | heap     | fn(T):T    | `fn(int,int):int f = fn(int a, int b):int {}` |                                     |
| struct   | stack    | struct {}  |                                               |                                     |
| arr      | stack    | arr<T,len> | `arr<u8,12> array = [1, 2, 3, 4]`             |                                     |

:::info
è¿™é‡Œä¸»è¦æ¼”ç¤ºç±»å‹çš„å®šä¹‰æ–¹å¼ï¼Œå…·ä½“ä½¿ç”¨å°†ä¼šåœ¨åç»­ç« èŠ‚è¯´æ˜ã€‚å¦å¤–å¦‚æœæ˜¯å˜é‡å£°æ˜çš„è¯æ¨èç”¨ var å…³é”®å­—è¿›è¡Œç±»å‹æ¨å¯¼ï¼Œä¸Šé¢æ˜¯æ¼”ç¤ºç¤ºä¾‹æ‰€ä»¥ç›´æ¥ä½¿ç”¨äº†ç±»å‹å£°æ˜ã€‚
:::

## ç‰¹æ®Šç±»å‹

### self

åœ¨ç»“æ„ä½“ä¸­ç›´æ¥å£°æ˜å‡½æ•°æ—¶ï¼Œç”¨æ¥å¼•å¯¼ç»“æ„ä½“è‡ªèº«ï¼Œç¤ºä¾‹

```nature
type square = struct {
    int length
    int width
    var area = fn(self s):int {
        return s.length * s.width
    }
}
```

æ­¤æ—¶ self ç­‰åŒäº `ptr<square>`

### ptr

å®‰å…¨æŒ‡é’ˆï¼Œnature ä¸­ç›®å‰ä¸æ”¯æŒå¯¹å˜é‡çš„å–æŒ‡é’ˆæ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨çš„åœºæ™¯æœ‰é™ï¼Œä¸»è¦ç”¨äºå’Œ c è¯­è¨€è¿›è¡Œäº¤äº’ã€‚ä½¿ç”¨ç¤ºä¾‹

```nature
type person = struct {}
ptr<person> = new person // v é€šè¿‡ new å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ– person, æ­¤æ—¶ person å°†ä¼šåœ¨å †ä¸­è¿›è¡Œåˆå§‹åŒ–
ptr<person> = null // x, å®‰å…¨æŒ‡é’ˆä¸å…è®¸èµ‹å€¼ä¸º null
```

### any

è¯­æ³•ç¤ºä¾‹

```nature
int foo = 1
int bar = 2
any car = foo // v è¿™é‡Œå‘ç”Ÿç´¯éšå¼ç±»å‹è½¬æ¢ï¼Œå°† int ç±»å‹çš„ foo è½¬æ¢æˆäº† any ç±»å‹
int baz = car // x any æ—¶å¤åˆç±»å‹ï¼Œä¸èƒ½èµ‹å€¼ç»™ int ç±»å‹çš„ baz å˜é‡ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©ç±»å‹æ–­è¨€æ¥è¿›è¡Œèµ‹å€¼
int baz = car as int // v as æ­¤æ—¶è¡¨ç¤º assert ç±»å‹æ–­è¨€ï¼Œå…¶ä¸ç±»å‹è½¬æ¢å…±ç”¨å…³é”®å­— as

bool isint = car is int // v ä½¿ç”¨ is å…³é”®å­—å¯ä»¥å¯¹ any/è”åˆç±»å‹å½“å‰çš„å®é™…å­˜å‚¨ç±»å‹è¿›è¡Œåˆ¤æ–­
```

### è”åˆç±»å‹

```nature
int|null foo = null
foo = 1
```

è”åˆç±»å‹æœ¬è´¨å°±æ˜¯ anyï¼Œåªæ˜¯å…·æœ‰æ›´å°çš„é€‰æ‹©èŒƒå›´ã€‚å†èŒƒå›´åŒ…å«çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…è®¸å¤§èŒƒå›´çš„è”åˆç±»å‹èµ‹å€¼ç»™å°èŒƒå›´çš„è”åˆç±»å‹ï¼Œå¦‚

```nature
int|float foo = null
int|float|null bar = foo // v bar çš„ç±»å‹èŒƒå›´å¤§äº foo

int|null baz = bar // x bar çš„ç±»å‹èŒƒå›´å¤§äº baz, æ‰€ä»¥ä¸å…è®¸èµ‹å€¼

any car = baz // v any åŒ…å«æ‰€æœ‰ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æ¥å—ä»»æ„å€¼

```

### null

null çš„ç±»å‹å®šä¹‰å’Œå€¼éƒ½æ˜¯å…³é”®å­— null

### cptr

ä¸€ç§é€šç”¨çš„æŒ‡é’ˆç±»å‹ï¼ŒæŒ‡é’ˆçš„æœ¬è´¨å°±æ˜¯ uint64 ç±»å‹ã€‚ctpr å’Œ c è¯­è¨€çš„ `void*` æ˜¯ç±»ä¼¼çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å¸¸ç”¨äºä¸ c è¯­è¨€è¿›è¡Œäº¤äº’ã€‚ æ¯”å¦‚

```nature
string s = 'hello world'
cptr p = s.ref() // å¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ª cptr

cptr a = 0 as cptr // ä»»ä½•ç±»å‹éƒ½å¯ä»¥è½¬æ¢ä¸º cptr ç±»å‹
```

### null æŒ‡é’ˆ `cptr<T>`

`cptr<T>` æ˜¯ `ptr<T>` çš„ç‰¹æ®Šå½¢å¼ï¼Œå…¶æ”¯æŒèµ‹å€¼ä¸º null, å…¶æœ¬è´¨ç±»ä¼¼ä¸ `ptr<T>|null` ä½†æ˜¯åœ¨å†…å­˜ç»“æ„ä¸Šä¸ union type ä¸åŒã€‚å…¶è‡³å ç”¨ 8byte é•¿åº¦ã€‚

```nature
type person = struct {
    string name
}

ptr<person> p = new person{}
cptr<person> p2 = null // v
cptr<person> p3 = p // v

println(p2.name) // v
println(p3.name) // x, cptr éœ€è¦ç»è¿‡ as æ–­è¨€æ‰èƒ½å¤Ÿä½¿ç”¨

let p3 as ptr<person> // v
println(p3.name) // v

let p3 as null // v, ä½†æ˜¯ä¼šå‡ºç°è¿è¡Œæ—¶é”™è¯¯

```

## ç±»å‹åˆ«å

```nature
type myint = int
```

ä½¿ç”¨å…³é”®å­— type å¯ä»¥å®šä¹‰ç±»å‹åˆ«åï¼Œä¸€èˆ¬ä¸ struct ç»„åˆä½¿ç”¨ã€‚ç±»å‹åˆ«ååŒæ ·ä¹Ÿæ”¯æŒå‚æ•°ï¼Œå¦‚

```nature
type nullable<t0> = t0|null
```

åç»­åœ¨æ³›å‹ä¸­ä¼šå†æ¬¡è§åˆ°ç±»å‹å‚æ•°çš„ä½¿ç”¨ã€‚

## ç±»å‹è½¬æ¢

nature æš‚æ—¶ä¸æ”¯æŒéšå¼ç±»å‹è½¬æ¢ã€‚è¯·ä½¿ç”¨ `expr as type` çš„æ–¹å¼è¿›è¡Œæ˜¾ç¤ºçš„ç±»å‹è½¬æ¢ã€‚å¦‚ `bool a = 12 as bool`

## å­—é¢é‡ç±»å‹

```nature
var foo = 1 // å­—é¢é‡ 1 é»˜è®¤ä¸º int ç±»å‹
u8 bar = 1 // ç”±äºå­—é¢é‡ 1 åœ¨èµ‹å€¼æ—¶åˆ¤æ–­åˆ° bar ä¸º u8 ç±»å‹ï¼Œä¸”å­—é¢é‡èŒƒå›´ç¬¦åˆ u8 èŒƒå›´ï¼Œæ‰€ä»¥æ­¤æ—¶ 1 é»˜è®¤ä¸º u8 ç±»å‹ï¼Œå¹¶ä¸éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ã€‚

u8 bar = 0x1A // 16 è¿›åˆ¶å­—é¢é‡

var car = 1.1 // å­—é¢é‡æµ®ç‚¹å‹é»˜è®¤ä¸º float ç±»å‹

var baz = true  // bool ç±»å‹
var baq = false // bool ç±»å‹

```

> ğŸ’¡ æš‚æ—¶ä¸æ”¯æŒ 2 è¿›åˆ¶å­—é¢é‡ä¸ 8 è¿›åˆ¶å­—é¢é‡

## å­—ç¬¦ä¸²

nature å¯ä»¥é€šè¿‡å•å¼•å·æˆ–è€…åŒå¼•å·æ¥åŒ…è£¹å­—ç¬¦ä¸²ï¼Œæ¨èä½¿ç”¨å•å¼•å·æ›´åŠ ç®€æ´ã€‚

è¿™æ˜¯å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡çš„ç¤ºä¾‹

```nature
var str = 'hello world' // æ­¤æ—¶ str æ˜¯ string ç±»å‹, ç­‰åŒäº string str = 'hello world'
```

### å­—ç¬¦ä¸²è½¬ä¹‰

æ— è®ºæ˜¯å•å¼•å·è¿˜æ˜¯åŒå¼•å·éƒ½ä¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰æ“ä½œï¼Œ ä¾‹å¦‚ `println('hello\nworld')` ç¼–è¯‘è¾“å‡ºå°†ä¼šå¾—åˆ°

```shell
> ./main
hello
world#
```

ç›®å‰æ”¯æŒçš„è½¬ä¹‰å­—ç¬¦æœ‰

```
\': å•å¼•å·å­—ç¬¦
\": åŒå¼•å·å­—ç¬¦
\\: åæ–œæ å­—ç¬¦
\n: æ¢è¡Œç¬¦
\r: å›è½¦ç¬¦
\t: åˆ¶è¡¨ç¬¦ï¼ˆTabé”®ï¼‰
\b: é€€æ ¼ç¬¦ï¼ˆå…‰æ ‡å·¦ç§»ä¸€æ ¼ï¼‰
\f: æ¢é¡µç¬¦
\v: å‚ç›´åˆ¶è¡¨ç¬¦
\a: å“é“ƒç¬¦ï¼ˆå‘å‡ºä¸€å£°â€œå“”â€ï¼‰
\0: ç©ºå­—ç¬¦ï¼ˆNULLå­—ç¬¦ï¼ŒASCIIç ä¸º0ï¼‰
```

### å­—ç¬¦ä¸²è¿ç®—

å¯ä»¥é€šè¿‡é€»è¾‘è¿ç®—ç¬¦å·ä¸æ¯”è¾ƒè¿ç®—ç¬¦æ“ä½œå­—ç¬¦ä¸²

```nature
string s = 'hello world'
string s2 = s + ' one piece'
println(s2) // hello world one piece


// å­—ç¬¦ä¸²æ¯”è¾ƒæ“ä½œ
println('hello world' == 'hello world') // true
println('hello world' != 'hello world') // false
println('a' < 'b') // true
println('a' > 'b') // false
```

### å­—ç¬¦ä¸²å¤„ç†

å­—ç¬¦ä¸²å’Œ vec å…·æœ‰ç›¸åŒçš„æ•°æ®è§£æ„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯¹ string è¿›è¡Œç±»ä¼¼ vec çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ as è¿›è¡Œç±»å‹è½¬æ¢ã€‚

```nature
string s = 'hello world'
(s[1], s[2]) = (s[2], s[1]) // å­—ç¬¦ä¸²äº¤æ¢

println(s[0], s[1]) // å¯ä»¥ç›´æ¥è®¿é—® string ä¸­çš„ item
var l = s as [u8] // å°† string è½¬æ¢æˆ [u8] ç±»å‹
l[0] = 110 // ascii ç¼–ç  n
```

åœ¨ä¸ c è¯­è¨€äº¤äº’æ—¶ï¼Œé€šå¸¸éœ€è¦ä¸€ä¸ª c ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ `\0` ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œä¸”ä¸åŒ…å« header ä¿¡æ¯ã€‚å¯ä»¥è°ƒç”¨å­—ç¬¦ä¸²å±æ€§æ–¹æ³• ref() å¾—åˆ° c è¯­è¨€å­—ç¬¦ä¸²ã€‚å…¶è¿”å›ä¸€ä¸ªé€šç”¨æŒ‡é’ˆç±»å‹ cptr

```nature
string s = 'hello world'

cptr p = s.ref()
```

s.ref() å¾—åˆ°çš„æ˜¯å¯¹åŸæœ‰å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ c ä¸­ä¿®æ”¹ p æŒ‡é’ˆä¸­çš„æ•°æ®ä¹Ÿä¼šå½±å“å­—ç¬¦ä¸² s ä¸­çš„æ•°æ®
